{{define "home"}}
{{template "layout" .}}
{{end}}

{{define "content"}}
<section class="surface stack">
  <div class="section-header">
    <div>
      <h2>Achats récents</h2>
      <p class="section-subtitle">Visualisez vos derniers approvisionnements et leurs montants.</p>
    </div>
    <p class="metric-pill">Total investi : {{formatMoney .Data.TotalInvested}}</p>
  </div>
  <div class="table-responsive">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Marque</th>
          <th>Sacs</th>
          <th>Poids total (kg)</th>
          <th>PU (€)</th>
          <th>Total</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        {{if .Data.Purchases}}
        {{range .Data.Purchases}}
        <tr>
          <td>{{formatDate .PurchasedAt}}</td>
          <td>{{.BrandName}}</td>
          <td>{{.Bags}}</td>
          <td>{{formatWeight .TotalWeightKg}}</td>
          <td>{{formatMoney .UnitPriceCents}}</td>
          <td>{{formatMoney .TotalPriceCents}}</td>
          <td>{{.Notes}}</td>
        </tr>
        {{end}}
        {{else}}
        <tr>
          <td colspan="7">Aucun achat enregistré pour le moment.</td>
        </tr>
        {{end}}
      </tbody>
    </table>
  </div>
</section>

<section class="surface stack">
  <div class="section-header">
    <div>
      <h3>Ajouter un achat</h3>
      <p class="section-subtitle">Saisissez le poids d'un sac et le nombre de sacs, le total est calculé automatiquement.</p>
    </div>
  </div>
  <form method="post" data-controller="purchase-form" class="stack">
    <div class="form-grid two-columns">
      <label>
        Marque
        <select name="brand_id" required>
          <option value="">Sélectionner…</option>
          {{range .Data.Brands}}
          <option value="{{.ID}}">{{.Name}}</option>
          {{end}}
        </select>
      </label>
      <label>
        Date d'achat
        <input type="date" name="purchased_at" data-default-today="true" required>
      </label>
      <label>
        Nombre de sacs
        <input type="number" name="bags" min="1" step="1" required>
      </label>
      <label>
        Poids par sac (kg)
        <input type="number" name="bag_weight_kg" min="0.1" step="0.1" required>
      </label>
      <label>
        Prix unitaire (€)
        <input type="number" name="unit_price_eur" min="0" step="0.01" required>
      </label>
      <label>
        Notes
        <textarea name="notes" placeholder="Commentaires optionnels"></textarea>
      </label>
    </div>
    <div>
      Total estimé : <output data-role="purchase-total">0,00 €</output><br>
      Poids total : <output data-role="purchase-weight-total">0,0</output> kg
    </div>
    <button type="submit">Enregistrer l'achat</button>
  </form>
</section>
{{end}}
